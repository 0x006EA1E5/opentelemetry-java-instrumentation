import org.beryx.jlink.BaseTask

plugins {
  id 'org.beryx.jlink' version '2.1.1' // latest version that doesn't have a Java 11+ warning
}

ext {
  minJavaVersionForTests = JavaVersion.VERSION_1_9
}

apply from: "${rootDir}/gradle/java.gradle"

mainClassName = 'datadog.smoketest.moduleapp.ModuleApplication'

jar {
  manifest {
    attributes(
      'Main-Class': 'datadog.smoketest.moduleapp.ModuleApplication'
    )
  }
}

jlink {
  moduleName = 'datadog.smoketest.moduleapp'
  options = ['--no-man-pages', '--no-header-files', '--add-modules', 'java.instrument']
}

tasks.withType(BaseTask).each {
  it.enabled = JavaVersion.VERSION_1_9.compareTo(JavaVersion.current()) <= 0
}

test {
  dependsOn tasks.jlink
}

dependencies {
  testCompile project(':dd-smoke-tests')
}

